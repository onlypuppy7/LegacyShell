//legacyshell: basic
import { devlog, isClient, isServer } from "#constants";
import { iterateXYZ } from "#loading";
//legacyshell: plugins
import { plugins } from '#plugins';
//

export const MultiplayerMapHost = {
    registerListeners: function (pluginManager) {
        console.log("registering listeners... (ChristmasEvent)");

        this.plugins = pluginManager;

        this.plugins.on('game:clientOnExtraGameInfo', this.onExtraGameInfoSub.bind(this));
        this.plugins.on('game:modifyMinMap', this.modifyMinMapSub.bind(this));
        this.plugins.on("game:onExtraParams", this.onExtraParamsSub.bind(this));
    },

    onExtraParamsSub(event){
      console.log("onExtraParams");
      //TODO: make this load into custom map if condition
      event.extraParams.useCustomMap = true;
      event.extraParams.minMap = { "fileVersion": 1, "sun": { "direction": { "x": 0.2, "y": 1, "z": -0.3 }, "color": "#E00000" }, "ambient": "#000000", "fog": { "density": 0.1, "color": "#33334C" }, "data": { "castle.brick-arch-side.aabb": [{ "x": 0, "y": 0, "z": 16 }, { "x": 2, "y": 0, "z": 16 }, { "x": 3, "y": 0, "z": 16 }, { "x": 4, "y": 0, "z": 13 }, { "x": 4, "y": 0, "z": 14 }, { "x": 4, "y": 0, "z": 15 }, { "x": 4, "y": 0, "z": 16 }, { "x": 5, "y": 0, "z": 13 }, { "x": 6, "y": 0, "z": 16 }, { "x": 8, "y": 0, "z": 12 }, { "x": 10, "y": 0, "z": 15 }, { "x": 10, "y": 0, "z": 16 }, { "x": 10, "y": 0, "z": 17 }, { "x": 10, "y": 0, "z": 24 }, { "x": 10, "y": 1, "z": 14 }, { "x": 10, "y": 1, "z": 15 }, { "x": 11, "y": 0, "z": 15 }, { "x": 11, "y": 0, "z": 16 }, { "x": 11, "y": 1, "z": 14 }, { "x": 11, "y": 1, "z": 15 }], "shipyard.container-blue.full": [{ "x": 3, "y": 0, "z": 26 }, { "x": 3, "y": 0, "z": 27 }, { "x": 3, "y": 0, "z": 28 }, { "x": 3, "y": 0, "z": 30 }, { "x": 3, "y": 1, "z": 28 }, { "x": 3, "y": 1, "z": 30 }, { "x": 3, "y": 2, "z": 26 }, { "x": 3, "y": 2, "z": 27 }, { "x": 3, "y": 2, "z": 28 }, { "x": 3, "y": 2, "z": 29 }, { "x": 3, "y": 2, "z": 30 }, { "x": 3, "y": 3, "z": 26 }, { "x": 3, "y": 3, "z": 28 }, { "x": 3, "y": 4, "z": 26 }, { "x": 3, "y": 4, "z": 28 }, { "x": 3, "y": 4, "z": 29 }, { "x": 3, "y": 4, "z": 30 }, { "x": 15, "y": 7, "z": 29 }, { "x": 15, "y": 7, "z": 30, "ry": 3 }], "SPECIAL.spawn-red.none": [{ "x": 3, "y": 5, "z": 26, "ry": 2 }, { "x": 15, "y": 8, "z": 29, "ry": 2 }, { "x": 16, "y": 10, "z": 22, "ry": 2 }], "SPECIAL.spawn-blue.none": [{ "x": 3, "y": 5, "z": 29, "ry": 2 }, { "x": 22, "y": 9, "z": 26, "ry": 2 }], "generic.green-block.full": [{ "x": 11, "y": 0, "z": 1 }, { "x": 12, "y": 0, "z": 1 }, { "x": 13, "y": 0, "z": 1 }, { "x": 13, "y": 0, "z": 8 }, { "x": 14, "y": 0, "z": 1 }, { "x": 14, "y": 0, "z": 8 }, { "x": 14, "y": 0, "z": 17 }, { "x": 14, "y": 1, "z": 8 }, { "x": 14, "y": 2, "z": 8 }, { "x": 15, "y": 0, "z": 1 }, { "x": 15, "y": 0, "z": 8 }, { "x": 15, "y": 0, "z": 17 }, { "x": 15, "y": 1, "z": 17 }, { "x": 15, "y": 2, "z": 17 }, { "x": 16, "y": 0, "z": 1 }, { "x": 16, "y": 0, "z": 17 }, { "x": 17, "y": 0, "z": 1 }, { "x": 18, "y": 0, "z": 1 }, { "x": 19, "y": 0, "z": 1 }, { "x": 19, "y": 0, "z": 9 }, { "x": 20, "y": 0, "z": 1 }, { "x": 20, "y": 0, "z": 9 }, { "x": 20, "y": 0, "z": 20 }, { "x": 20, "y": 1, "z": 9 }, { "x": 20, "y": 2, "z": 9 }, { "x": 21, "y": 0, "z": 0 }, { "x": 21, "y": 0, "z": 1 }, { "x": 21, "y": 0, "z": 9 }, { "x": 21, "y": 0, "z": 20 }, { "x": 21, "y": 1, "z": 20 }, { "x": 21, "y": 2, "z": 20 }, { "x": 22, "y": 0, "z": 0 }, { "x": 22, "y": 0, "z": 20 }, { "x": 23, "y": 0, "z": 0 }, { "x": 24, "y": 0, "z": 0 }, { "x": 25, "y": 0, "z": 0 }, { "x": 26, "y": 0, "z": 0 }, { "x": 27, "y": 0, "z": 0 }, { "x": 28, "y": 0, "z": 0 }, { "x": 29, "y": 0, "z": 0 }, { "x": 31, "y": 0, "z": 6 }, { "x": 31, "y": 0, "z": 8 }, { "x": 31, "y": 0, "z": 9 }, { "x": 31, "y": 0, "z": 11 }, { "x": 31, "y": 0, "z": 13 }, { "x": 31, "y": 1, "z": 13 }, { "x": 31, "y": 3, "z": 14 }, { "x": 32, "y": 0, "z": 14 }, { "x": 32, "y": 0, "z": 15 }, { "x": 32, "y": 0, "z": 16 }, { "x": 32, "y": 1, "z": 13 }, { "x": 32, "y": 1, "z": 14 }, { "x": 32, "y": 1, "z": 15 }, { "x": 32, "y": 2, "z": 13 }, { "x": 32, "y": 2, "z": 14 }, { "x": 32, "y": 2, "z": 15 }, { "x": 32, "y": 2, "z": 16 }, { "x": 32, "y": 2, "z": 17 }, { "x": 32, "y": 3, "z": 14 }, { "x": 32, "y": 3, "z": 15 }, { "x": 32, "y": 3, "z": 17 }, { "x": 32, "y": 4, "z": 14 }, { "x": 32, "y": 4, "z": 15 }, { "x": 32, "y": 4, "z": 16 }], "town.shop4.full": [{ "x": 13, "y": 0, "z": 9, "ry": 1 }, { "x": 14, "y": 0, "z": 21 }, { "x": 14, "y": 0, "z": 22 }, { "x": 14, "y": 0, "z": 23 }, { "x": 14, "y": 1, "z": 17, "ry": 1 }, { "x": 14, "y": 1, "z": 21, "ry": 3 }, { "x": 14, "y": 1, "z": 22, "ry": 3 }, { "x": 14, "y": 1, "z": 23 }, { "x": 14, "y": 2, "z": 21, "ry": 3 }, { "x": 14, "y": 2, "z": 22, "ry": 3 }, { "x": 14, "y": 2, "z": 23 }, { "x": 14, "y": 3, "z": 21, "ry": 3 }, { "x": 14, "y": 3, "z": 22, "ry": 3 }, { "x": 14, "y": 3, "z": 23 }, { "x": 14, "y": 4, "z": 21, "ry": 3 }, { "x": 14, "y": 4, "z": 22, "ry": 3 }, { "x": 14, "y": 4, "z": 23 }, { "x": 14, "y": 5, "z": 21, "ry": 3 }, { "x": 14, "y": 5, "z": 22, "ry": 3 }, { "x": 14, "y": 5, "z": 23 }, { "x": 14, "y": 6, "z": 21, "ry": 3 }, { "x": 14, "y": 6, "z": 22, "ry": 3 }, { "x": 14, "y": 6, "z": 23 }, { "x": 14, "y": 7, "z": 21, "ry": 3 }, { "x": 14, "y": 7, "z": 22, "ry": 3 }, { "x": 14, "y": 7, "z": 23 }, { "x": 14, "y": 8, "z": 21, "ry": 3 }, { "x": 14, "y": 8, "z": 22, "ry": 3 }, { "x": 14, "y": 8, "z": 23 }, { "x": 14, "y": 9, "z": 21, "ry": 3 }, { "x": 14, "y": 9, "z": 22 }, { "x": 14, "y": 9, "z": 23 }, { "x": 15, "y": 0, "z": 21 }, { "x": 15, "y": 0, "z": 22 }, { "x": 15, "y": 0, "z": 23 }, { "x": 15, "y": 1, "z": 21, "ry": 1 }, { "x": 15, "y": 1, "z": 22, "ry": 1 }, { "x": 15, "y": 1, "z": 23, "ry": 1 }, { "x": 15, "y": 2, "z": 21, "ry": 3 }, { "x": 15, "y": 2, "z": 22, "ry": 3 }, { "x": 15, "y": 2, "z": 23, "ry": 1 }, { "x": 15, "y": 3, "z": 21, "ry": 3 }, { "x": 15, "y": 3, "z": 22, "ry": 3 }, { "x": 15, "y": 3, "z": 23, "ry": 1 }, { "x": 15, "y": 4, "z": 21, "ry": 3 }, { "x": 15, "y": 4, "z": 22, "ry": 3 }, { "x": 15, "y": 4, "z": 23, "ry": 1 }, { "x": 15, "y": 5, "z": 21, "ry": 3 }, { "x": 15, "y": 5, "z": 22, "ry": 3 }, { "x": 15, "y": 5, "z": 23, "ry": 1 }, { "x": 15, "y": 6, "z": 21, "ry": 3 }, { "x": 15, "y": 6, "z": 22, "ry": 3 }, { "x": 15, "y": 6, "z": 23, "ry": 1 }, { "x": 15, "y": 7, "z": 21, "ry": 3 }, { "x": 15, "y": 7, "z": 22, "ry": 3 }, { "x": 15, "y": 7, "z": 23, "ry": 1 }, { "x": 15, "y": 8, "z": 21, "ry": 3 }, { "x": 15, "y": 8, "z": 22, "ry": 3 }, { "x": 15, "y": 8, "z": 23, "ry": 1 }, { "x": 15, "y": 9, "z": 21, "ry": 3 }, { "x": 15, "y": 9, "z": 22, "ry": 3 }, { "x": 15, "y": 9, "z": 23, "ry": 1 }, { "x": 16, "y": 0, "z": 21, "ry": 1 }, { "x": 16, "y": 0, "z": 22, "ry": 1 }, { "x": 16, "y": 0, "z": 23, "ry": 1 }, { "x": 16, "y": 1, "z": 21, "ry": 1 }, { "x": 16, "y": 1, "z": 22, "ry": 1 }, { "x": 16, "y": 1, "z": 23, "ry": 1 }, { "x": 16, "y": 2, "z": 21, "ry": 1 }, { "x": 16, "y": 2, "z": 22, "ry": 1 }, { "x": 16, "y": 2, "z": 23, "ry": 1 }, { "x": 16, "y": 3, "z": 21, "ry": 1 }, { "x": 16, "y": 3, "z": 22, "ry": 1 }, { "x": 16, "y": 3, "z": 23, "ry": 1 }, { "x": 16, "y": 4, "z": 21, "ry": 1 }, { "x": 16, "y": 4, "z": 22, "ry": 1 }, { "x": 16, "y": 4, "z": 23, "ry": 1 }, { "x": 16, "y": 5, "z": 21, "ry": 1 }, { "x": 16, "y": 5, "z": 22, "ry": 1 }, { "x": 16, "y": 5, "z": 23, "ry": 1 }, { "x": 16, "y": 6, "z": 21, "ry": 1 }, { "x": 16, "y": 6, "z": 22, "ry": 1 }, { "x": 16, "y": 6, "z": 23, "ry": 1 }, { "x": 16, "y": 7, "z": 21, "ry": 1 }, { "x": 16, "y": 7, "z": 22, "ry": 1 }, { "x": 16, "y": 7, "z": 23, "ry": 1 }, { "x": 16, "y": 8, "z": 21, "ry": 1 }, { "x": 16, "y": 8, "z": 22, "ry": 1 }, { "x": 16, "y": 8, "z": 23, "ry": 1 }, { "x": 16, "y": 9, "z": 21, "ry": 1 }, { "x": 16, "y": 9, "z": 22, "ry": 1 }, { "x": 16, "y": 9, "z": 23, "ry": 1 }, { "x": 21, "y": 0, "z": 25 }, { "x": 21, "y": 0, "z": 26 }, { "x": 21, "y": 0, "z": 27 }, { "x": 21, "y": 1, "z": 25 }, { "x": 21, "y": 1, "z": 26 }, { "x": 21, "y": 1, "z": 27 }, { "x": 21, "y": 2, "z": 25 }, { "x": 21, "y": 2, "z": 26 }, { "x": 21, "y": 2, "z": 27 }, { "x": 21, "y": 3, "z": 25 }, { "x": 21, "y": 3, "z": 26 }, { "x": 21, "y": 3, "z": 27 }, { "x": 21, "y": 4, "z": 25 }, { "x": 21, "y": 4, "z": 26 }, { "x": 21, "y": 4, "z": 27 }, { "x": 21, "y": 5, "z": 25 }, { "x": 21, "y": 5, "z": 26 }, { "x": 21, "y": 5, "z": 27 }, { "x": 21, "y": 6, "z": 25 }, { "x": 21, "y": 6, "z": 26 }, { "x": 21, "y": 6, "z": 27 }, { "x": 21, "y": 7, "z": 25 }, { "x": 21, "y": 7, "z": 26 }, { "x": 21, "y": 7, "z": 27 }, { "x": 21, "y": 8, "z": 25 }, { "x": 21, "y": 8, "z": 26 }, { "x": 21, "y": 8, "z": 27 }, { "x": 22, "y": 0, "z": 25 }, { "x": 22, "y": 0, "z": 26 }, { "x": 22, "y": 0, "z": 27 }, { "x": 22, "y": 1, "z": 25 }, { "x": 22, "y": 1, "z": 26 }, { "x": 22, "y": 1, "z": 27 }, { "x": 22, "y": 2, "z": 25 }, { "x": 22, "y": 2, "z": 26 }, { "x": 22, "y": 2, "z": 27 }, { "x": 22, "y": 3, "z": 25 }, { "x": 22, "y": 3, "z": 26 }, { "x": 22, "y": 3, "z": 27 }, { "x": 22, "y": 4, "z": 25 }, { "x": 22, "y": 4, "z": 26 }, { "x": 22, "y": 4, "z": 27 }, { "x": 22, "y": 5, "z": 25 }, { "x": 22, "y": 5, "z": 26 }, { "x": 22, "y": 5, "z": 27 }, { "x": 22, "y": 6, "z": 25 }, { "x": 22, "y": 6, "z": 26 }, { "x": 22, "y": 6, "z": 27 }, { "x": 22, "y": 7, "z": 25 }, { "x": 22, "y": 7, "z": 26 }, { "x": 22, "y": 7, "z": 27 }, { "x": 22, "y": 8, "z": 25 }, { "x": 22, "y": 8, "z": 26 }, { "x": 22, "y": 8, "z": 27 }, { "x": 23, "y": 0, "z": 25 }, { "x": 23, "y": 0, "z": 26 }, { "x": 23, "y": 0, "z": 27 }, { "x": 23, "y": 1, "z": 25 }, { "x": 23, "y": 1, "z": 26 }, { "x": 23, "y": 1, "z": 27 }, { "x": 23, "y": 2, "z": 25 }, { "x": 23, "y": 2, "z": 26 }, { "x": 23, "y": 2, "z": 27 }, { "x": 23, "y": 3, "z": 25 }, { "x": 23, "y": 3, "z": 26 }, { "x": 23, "y": 3, "z": 27 }, { "x": 23, "y": 4, "z": 25 }, { "x": 23, "y": 4, "z": 26 }, { "x": 23, "y": 4, "z": 27 }, { "x": 23, "y": 5, "z": 25 }, { "x": 23, "y": 5, "z": 26 }, { "x": 23, "y": 5, "z": 27 }, { "x": 23, "y": 6, "z": 25 }, { "x": 23, "y": 6, "z": 26 }, { "x": 23, "y": 6, "z": 27 }, { "x": 23, "y": 7, "z": 25 }, { "x": 23, "y": 7, "z": 26 }, { "x": 23, "y": 7, "z": 27 }, { "x": 23, "y": 8, "z": 25 }, { "x": 23, "y": 8, "z": 26 }, { "x": 23, "y": 8, "z": 27 }], "town.fire-escape-bridge.aabb.soft": [{ "x": 13, "y": 0, "z": 35 }, { "x": 13, "y": 1, "z": 35 }, { "x": 14, "y": 0, "z": 28 }, { "x": 14, "y": 0, "z": 29 }, { "x": 14, "y": 0, "z": 34 }, { "x": 14, "y": 0, "z": 35 }, { "x": 15, "y": 0, "z": 27 }, { "x": 15, "y": 0, "z": 30 }, { "x": 15, "y": 0, "z": 31 }, { "x": 15, "y": 0, "z": 32 }, { "x": 15, "y": 0, "z": 33 }, { "x": 15, "y": 0, "z": 34 }, { "x": 15, "y": 1, "z": 34 }, { "x": 16, "y": 0, "z": 27 }, { "x": 16, "y": 0, "z": 30 }, { "x": 16, "y": 0, "z": 31 }], "generic.plain-angle-ceiling.iwedge": [{ "x": 14, "y": 7, "z": 29, "ry": 3 }, { "x": 15, "y": 7, "z": 28, "ry": 2 }, { "x": 15, "y": 7, "z": 31 }, { "x": 16, "y": 7, "z": 29, "ry": 1 }], "raceline.bottomside.aabb": [{ "x": 15, "y": 10, "z": 22, "ry": 3 }, { "x": 15, "y": 11, "z": 22, "ry": 3 }, { "x": 15, "y": 12, "z": 22, "ry": 3 }, { "x": 15, "y": 13, "z": 22, "ry": 3 }], "raceline.topside-02.aabb": [{ "x": 15, "y": 14, "z": 22, "ry": 3 }], "town.shop2.full": [{ "x": 21, "y": 0, "z": 34 }, { "x": 21, "y": 1, "z": 34 }, { "x": 21, "y": 2, "z": 34 }, { "x": 22, "y": 0, "z": 34 }, { "x": 22, "y": 1, "z": 34 }, { "x": 22, "y": 2, "z": 34 }, { "x": 23, "y": 0, "z": 34 }, { "x": 23, "y": 1, "z": 34 }, { "x": 23, "y": 2, "z": 34 }], "trainyard.junctionhouse-top.obb": [{ "x": 32, "y": 0, "z": 27, "ry": 2 }] }, "palette": ["generic.green-block.full", "SPECIAL.spawn-red.none", "trainyard.junctionhouse-top.obb", "town.shop2.full", "town.shop4.full", "castle.brick-arch-side.aabb", "town.shop3.full", "generic.plain-angle-ceiling.iwedge", "raceline.topside-02.aabb", "scifi.roof.wedge"], "render": { "pointLightIntensity": 0.5 }, "width": 33, "height": 15, "depth": 36, "name": "", "surfaceArea": 115, "extents": { "x": { "max": 44, "min": 12 }, "y": { "max": 14, "min": 0 }, "z": { "max": 36, "min": 1 }, "width": 33, "height": 15, "depth": 36 }, "skybox": "night", "modes": { "FFA": true, "Teams": true, "Spatula": true, "King": true }, "availability": "both", "numPlayers": "18" };
    },

    onExtraGameInfoSub(event){
      this.useCustomMap = event.useCustomMap;
      if(this.useCustomMap && event.minMap){
        try{
          this.minMap = event.minMap;
          console.log(`rec cust map ${this.minMap}`);
        }catch(e){
          console.log(e);
        }
      }
    },

    modifyMinMapSub(event){
      if(!event.modify && this.useCustomMap && this.minMap){ //make sure we're not overriding some other plugin's minMap
        event.modify = true;
        event.minMap = this.minMap;
      }
    }
};

if (isClient) MultiplayerMapHost.registerListeners(plugins);
